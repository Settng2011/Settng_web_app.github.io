<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Game Hub - –ó–º–µ–π–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #8a2be2;
            --secondary: #00d4ff;
            --accent: #ff4081;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --success: #00ff88;
            --warning: #ffcc00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px var(--secondary); }
            50% { box-shadow: 0 0 20px var(--secondary); }
            100% { box-shadow: 0 0 10px var(--secondary); }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--secondary);
            font-size: 1.3rem;
        }

        .profile {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(0, 212, 255, 0.2));
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--secondary);
            object-fit: cover;
            animation: glow 2s infinite;
        }

        .user-details h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--light);
        }

        .user-details p {
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 3px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            transition: all 0.3s;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--success);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
        }

        .leaderboard {
            background: linear-gradient(135deg, rgba(255, 64, 129, 0.2), rgba(255, 204, 0, 0.2));
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .leaderboard-item.me {
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.2), transparent);
            border-left: 4px solid var(--secondary);
        }

        .rank {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 15px;
        }

        .rank-1 { background: gold; color: #000; }
        .rank-2 { background: silver; color: #000; }
        .rank-3 { background: #cd7f32; color: #000; }
        .rank-other { background: rgba(255, 255, 255, 0.1); }

        .player-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .player-name {
            font-weight: bold;
            color: var(--light);
        }

        .player-score {
            color: var(--success);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .game-container {
            grid-column: span 2;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(138, 43, 226, 0.1));
            padding: 25px;
            border-radius: 20px;
        }

        @media (max-width: 768px) {
            .game-container {
                grid-column: span 1;
            }
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 1.5rem;
            color: var(--success);
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            animation: pulse 2s infinite;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(138, 43, 226, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
        }

        .btn-danger:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 65, 108, 0.4);
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
        }

        .game-instructions {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            font-size: 0.9rem;
            color: #aaa;
            text-align: center;
        }

        .highlight {
            color: var(--secondary);
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(45deg, var(--accent), #ff9966);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            animation: pulse 1.5s infinite;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--secondary);
        }

        .emoji {
            font-size: 1.2em;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #666;
            font-size: 0.9rem;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
#touch-controls button:active {
    background: linear-gradient(135deg, rgba(255, 64, 129, 0.9), rgba(255, 204, 0, 0.9)) !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 480px) {
    .controls {
        flex-direction: column;
        gap: 10px;
    }
    
    .btn {
        width: 100%;
        padding: 15px;
    }
    
    .game-instructions {
        font-size: 0.8rem;
        padding: 10px;
    }
    
    /* –£–º–µ–Ω—å—à–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
    #touch-controls button {
        width: 60px;
        height: 60px;
        font-size: 20px;
    }
    
    .joystick-container {
        width: 100px;
        height: 100px;
    }
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
@keyframes slideUp {
    from {
        transform: translateY(100px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

#touch-controls {
    animation: slideUp 0.5s ease-out;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.mobile-controls-hint {
    position: fixed;
    bottom: 200px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 212, 255, 0.9);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 14px;
    z-index: 999;
    animation: pulse 2s infinite;
    display: none;
}

/* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ */
.touch-button-active {
    transform: scale(0.85) !important;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2) !important;
    transition: transform 0.1s !important;
}
    </style>
</head>
<body>
    <div class="container" id="app" style="display: none;">
        <div class="header">
            <h1>üéÆ Telegram Game Hub</h1>
            <p class="subtitle">–ò–≥—Ä–∞–π –≤ –∑–º–µ–π–∫—É, —Å–æ—Ä–µ–≤–Ω—É–π—Å—è —Å –¥—Ä—É–∑—å—è–º–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π —Ä–µ–∫–æ—Ä–¥—ã!</p>
        </div>

        <div class="content">
            <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="card profile">
                <div class="card-title">
                    <span class="emoji">üë§</span> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                    <span class="badge" id="user-badge">VIP</span>
                </div>
                <div class="profile-info">
                    <img id="user-avatar" class="avatar" src="" alt="Avatar">
                    <div class="user-details">
                        <h3 id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                        <p><span class="emoji">üÜî</span> ID: <span id="user-id">-</span></p>
                        <p><span class="emoji">üåê</span> –Ø–∑—ã–∫: <span id="user-language">-</span></p>
                        <p><span class="emoji">üé®</span> –¢–µ–º–∞: <span id="user-theme">-</span></p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="games-played">0</div>
                        <div class="stat-label">–°—ã–≥—Ä–∞–Ω–æ –∏–≥—Ä</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="high-score">0</div>
                        <div class="stat-label">–†–µ–∫–æ—Ä–¥</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="rank">#1</div>
                        <div class="stat-label">–†–∞–Ω–≥</div>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ -->
            <div class="card leaderboard">
                <div class="card-title">
                    <span class="emoji">üèÜ</span> –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤
                </div>
                <ul class="leaderboard-list" id="leaderboard">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </ul>
            </div>

            <!-- –ò–≥—Ä–∞ –ó–º–µ–π–∫–∞ -->
            <div class="game-container">
                <div class="game-header">
                    <div class="score-display">
                        <span class="emoji">‚≠ê</span> –°—á–µ—Ç: <span id="current-score">0</span>
                    </div>
                    <div class="controls">
                        <button class="btn btn-secondary" id="pauseBtn">
                            <span class="emoji">‚è∏Ô∏è</span> –ü–∞—É–∑–∞
                        </button>
                        <button class="btn btn-danger" id="restartBtn">
                            <span class="emoji">üîÑ</span> –ó–∞–Ω–æ–≤–æ
                        </button>
                    </div>
                </div>
                
                <canvas id="gameCanvas" width="800" height="500"></canvas>
                
                <div class="game-instructions">
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: <span class="highlight">–°—Ç—Ä–µ–ª–∫–∏ ‚Üê ‚Üë ‚Üí ‚Üì</span> –∏–ª–∏ <span class="highlight">WASD</span></p>
                    <p>–°–æ–±–µ—Ä–∏ –µ–¥—É <span class="emoji">üçé</span> –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ –∏ –¥–ª–∏–Ω—ã –∑–º–µ–π–∫–∏!</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" id="playBtn">
                        <span class="emoji">üéÆ</span> –ò–≥—Ä–∞—Ç—å –≤ –ó–º–µ–π–∫—É
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Telegram Game Hub ‚Ä¢ –°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è Telegram Mini Apps</p>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WebApp Telegram –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–ø—ã—Ç–∞</p>
        </div>
    </div>

    <div class="loading" id="loading">
        <div style="font-size: 2rem; margin-bottom: 20px;">üéÆ</div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞...</p>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe.user;
        const userId = user?.id || Math.floor(Math.random() * 10000);
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameActive = false;
        let currentScore = 0;
        let highScore = localStorage.getItem(`snake_high_score_${userId}`) || 0;
        let gamesPlayed = localStorage.getItem(`games_played_${userId}`) || 0;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.expand();
            tg.ready();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
            document.body.style.backgroundColor = tg.themeParams.bg_color || '#1a1a2e';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
            if (user) {
                document.getElementById('user-name').textContent = 
                    `${user.first_name || ''} ${user.last_name || ''}`.trim() || '–ê–Ω–æ–Ω–∏–º–Ω—ã–π –∏–≥—Ä–æ–∫';
                document.getElementById('user-id').textContent = userId;
                document.getElementById('user-language').textContent = user.language_code || 'ru';
                document.getElementById('user-avatar').src = user.photo_url || 'https://via.placeholder.com/80';
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É –∏–∑ Telegram
            const theme = tg.colorScheme;
            document.getElementById('user-theme').textContent = theme === 'dark' ? '–¢–µ–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('high-score').textContent = highScore;
            document.getElementById('games-played').textContent = gamesPlayed;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
            generateLeaderboard();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            initSnakeGame();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            setTimeout(() => {
                tg.HapticFeedback.impactOccurred('light');
            }, 500);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
        function generateLeaderboard() {
            const leaderboard = [
                { id: user?.id || 1, name: user?.first_name || '–í—ã', score: highScore, isMe: true },
                { id: 2, name: '–ê–ª–µ–∫—Å–µ–π', score: Math.floor(Math.random() * 100) + 50, isMe: false },
                { id: 3, name: '–ú–∞—Ä–∏—è', score: Math.floor(Math.random() * 100) + 40, isMe: false },
                { id: 4, name: '–î–º–∏—Ç—Ä–∏–π', score: Math.floor(Math.random() * 100) + 30, isMe: false },
                { id: 5, name: '–ê–Ω–Ω–∞', score: Math.floor(Math.random() * 100) + 20, isMe: false }
            ];
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º
            leaderboard.sort((a, b) => b.score - a.score);
            
            const leaderboardEl = document.getElementById('leaderboard');
            leaderboardEl.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const li = document.createElement('li');
                li.className = `leaderboard-item ${player.isMe ? 'me' : ''}`;
                
                const rankClass = `rank rank-${index + 1 <= 3 ? index + 1 : 'other'}`;
                
                li.innerHTML = `
                    <div style="display: flex; align-items: center; width: 100%;">
                        <div class="${rankClass}">${index + 1}</div>
                        <div class="player-info">
                            <div class="player-name">${player.name} ${player.isMe ? 'üëà' : ''}</div>
                        </div>
                        <div class="player-score">${player.score}</div>
                    </div>
                `;
                
                leaderboardEl.appendChild(li);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userRank = leaderboard.findIndex(p => p.isMe) + 1;
            document.getElementById('rank').textContent = `#${userRank}`;
        }

        // –ò–≥—Ä–∞ –ó–º–µ–π–∫–∞ —Å —Å–µ–Ω—Å–æ—Ä–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
function initSnakeGame() {
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–∞–Ω–≤–∞—Å–∞
    function resizeCanvas() {
        const maxWidth = Math.min(800, window.innerWidth - 50);
        canvas.width = maxWidth;
        canvas.height = Math.min(500, maxWidth * 0.625);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
        updateTouchControlsPosition();
    }
    
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let snake = [{x: 10, y: 10}];
    let food = {x: 15, y: 15};
    let dx = 1, dy = 0;
    let gameLoop;
    let isPaused = false;
    
    // –†–∞–∑–º–µ—Ä—ã —Å–µ—Ç–∫–∏
    const gridSize = 20;
    
    // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    let touchStartX = 0;
    let touchStartY = 0;
    let touchEndX = 0;
    let touchEndY = 0;
    let isTouching = false;
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–¥—ã
    function generateFood() {
        food = {
            x: Math.floor(Math.random() * (canvas.width / gridSize)),
            y: Math.floor(Math.random() * (canvas.height / gridSize))
        };
    }
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
    function draw() {
        // –û—á–∏—Å—Ç–∫–∞ –∫–∞–Ω–≤–∞—Å–∞
        ctx.fillStyle = 'rgba(26, 26, 46, 0.8)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
        ctx.lineWidth = 1;
        for (let x = 0; x < canvas.width; x += gridSize) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
        }
        for (let y = 0; y < canvas.height; y += gridSize) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–º–µ–π–∫–∏
        snake.forEach((segment, index) => {
            const gradient = ctx.createLinearGradient(
                segment.x * gridSize, 
                segment.y * gridSize,
                segment.x * gridSize + gridSize,
                segment.y * gridSize + gridSize
            );
            
            if (index === 0) {
                // –ì–æ–ª–æ–≤–∞
                gradient.addColorStop(0, '#00ff88');
                gradient.addColorStop(1, '#00cc6a');
                ctx.fillStyle = gradient;
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                
                // –ì–ª–∞–∑–∞
                ctx.fillStyle = '#fff';
                ctx.fillRect(segment.x * gridSize + 4, segment.y * gridSize + 4, 4, 4);
                ctx.fillRect(segment.x * gridSize + 12, segment.y * gridSize + 4, 4, 4);
            } else {
                // –¢–µ–ª–æ
                gradient.addColorStop(0, '#00d4ff');
                gradient.addColorStop(1, '#0088ff');
                ctx.fillStyle = gradient;
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                
                // –≠—Ñ—Ñ–µ–∫—Ç —á–µ—à—É–∏
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.fillRect(segment.x * gridSize + 3, segment.y * gridSize + 3, 2, 2);
            }
            
            // –û–±–≤–æ–¥–∫–∞
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.strokeRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
        });
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –µ–¥—ã
        ctx.fillStyle = '#ff4081';
        ctx.beginPath();
        ctx.arc(
            food.x * gridSize + gridSize/2,
            food.y * gridSize + gridSize/2,
            gridSize/2,
            0,
            Math.PI * 2
        );
        ctx.fill();
        
        // –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –¥–ª—è –µ–¥—ã
        ctx.shadowColor = '#ff4081';
        ctx.shadowBlur = 15;
        ctx.fill();
        ctx.shadowBlur = 0;
        
        // –¢–µ–∫—Å—Ç —è–±–ª–æ–∫–∞
        ctx.fillStyle = '#fff';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('üçé', food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2 + 4);
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
    function update() {
        if (isPaused || !gameActive) return;
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
        if (
            head.x < 0 || 
            head.x >= canvas.width / gridSize ||
            head.y < 0 || 
            head.y >= canvas.height / gridSize
        ) {
            gameOver();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
        if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
            gameOver();
            return;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≥–æ–ª–æ–≤—É
        snake.unshift(head);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—ä–µ–¥–∞–Ω–∏—è –µ–¥—ã
        if (head.x === food.x && head.y === food.y) {
            // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å—ä–µ–¥–∞–Ω–∏–∏
            tg.HapticFeedback.impactOccurred('medium');
            
            currentScore += 10;
            document.getElementById('current-score').textContent = currentScore;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥
            if (currentScore > highScore) {
                highScore = currentScore;
                document.getElementById('high-score').textContent = highScore;
                localStorage.setItem(`snake_high_score_${userId}`, highScore);
                generateLeaderboard();
            }
            
            generateFood();
        } else {
            // –£–¥–∞–ª—è–µ–º —Ö–≤–æ—Å—Ç, –µ—Å–ª–∏ –Ω–µ —Å—ä–µ–ª–∏ –µ–¥—É
            snake.pop();
        }
        
        draw();
    }
    
    // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
    function gameOver() {
        gameActive = false;
        clearInterval(gameLoop);
        
        gamesPlayed++;
        localStorage.setItem(`games_played_${userId}`, gamesPlayed);
        document.getElementById('games-played').textContent = gamesPlayed;
        
        tg.HapticFeedback.impactOccurred('heavy');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#ff4081';
        ctx.font = 'bold 36px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!', canvas.width/2, canvas.height/2 - 40);
        
        ctx.fillStyle = '#fff';
        ctx.font = '24px Arial';
        ctx.fillText(`–°—á–µ—Ç: ${currentScore}`, canvas.width/2, canvas.height/2 + 10);
        
        ctx.fillStyle = '#00d4ff';
        ctx.font = '18px Arial';
        ctx.fillText('–ù–∞–∂–º–∏—Ç–µ "–ó–∞–Ω–æ–≤–æ" –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã', canvas.width/2, canvas.height/2 + 50);
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    function changeDirection(event) {
        if (!gameActive) return;
        
        const key = event.key.toLowerCase();
        
        // –°—Ç—Ä–µ–ª–∫–∏ –∏ WASD
        const leftKeys = ['arrowleft', 'a', '—Ñ'];
        const upKeys = ['arrowup', 'w', '—Ü'];
        const rightKeys = ['arrowright', 'd', '–≤'];
        const downKeys = ['arrowdown', 's', '—ã'];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –∑–º–µ–π–∫–∞ –Ω–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–ª–∞—Å—å –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤
        if (leftKeys.includes(key) && dx !== 1) {
            dx = -1;
            dy = 0;
            event.preventDefault();
        } else if (upKeys.includes(key) && dy !== 1) {
            dx = 0;
            dy = -1;
            event.preventDefault();
        } else if (rightKeys.includes(key) && dx !== -1) {
            dx = 1;
            dy = 0;
            event.preventDefault();
        } else if (downKeys.includes(key) && dy !== -1) {
            dx = 0;
            dy = 1;
            event.preventDefault();
        }
    }
    
    // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - —Å–≤–∞–π–ø—ã
    function handleTouchStart(e) {
        e.preventDefault();
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
        isTouching = true;
    }
    
    function handleTouchMove(e) {
        if (!isTouching || !gameActive) return;
        e.preventDefault();
        const touch = e.touches[0];
        touchEndX = touch.clientX;
        touchEndY = touch.clientY;
    }
    
    function handleTouchEnd(e) {
        if (!isTouching || !gameActive) return;
        e.preventDefault();
        isTouching = false;
        
        const deltaX = touchEndX - touchStartX;
        const deltaY = touchEndY - touchStartY;
        
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–≤–∞–π–ø–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        const minSwipeDistance = 30;
        
        if (Math.abs(deltaX) > Math.abs(deltaY)) {
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
            if (Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0 && dx !== -1) {
                    // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ
                    dx = 1;
                    dy = 0;
                    tg.HapticFeedback.impactOccurred('light');
                } else if (deltaX < 0 && dx !== 1) {
                    // –°–≤–∞–π–ø –≤–ª–µ–≤–æ
                    dx = -1;
                    dy = 0;
                    tg.HapticFeedback.impactOccurred('light');
                }
            }
        } else {
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
            if (Math.abs(deltaY) > minSwipeDistance) {
                if (deltaY > 0 && dy !== -1) {
                    // –°–≤–∞–π–ø –≤–Ω–∏–∑
                    dx = 0;
                    dy = 1;
                    tg.HapticFeedback.impactOccurred('light');
                } else if (deltaY < 0 && dy !== 1) {
                    // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö
                    dx = 0;
                    dy = -1;
                    tg.HapticFeedback.impactOccurred('light');
                }
            }
        }
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    function createTouchControls() {
        const touchControlsContainer = document.createElement('div');
        touchControlsContainer.id = 'touch-controls';
        touchControlsContainer.style.cssText = `
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        `;
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const controlsWrapper = document.createElement('div');
        controlsWrapper.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            pointer-events: auto;
        `;
        
        // –í–µ—Ä—Ö–Ω–∏–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫ (–≤–≤–µ—Ä—Ö)
        const topRow = document.createElement('div');
        topRow.style.cssText = `
            display: flex;
            justify-content: center;
        `;
        
        const upButton = createDirectionButton('‚Üë', 'up', '–í–≤–µ—Ä—Ö', () => {
            if (gameActive && dy !== 1) {
                dx = 0;
                dy = -1;
                tg.HapticFeedback.impactOccurred('light');
            }
        });
        topRow.appendChild(upButton);
        
        // –°—Ä–µ–¥–Ω–∏–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫ (–≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
        const middleRow = document.createElement('div');
        middleRow.style.cssText = `
            display: flex;
            gap: 60px;
            justify-content: center;
            align-items: center;
        `;
        
        const leftButton = createDirectionButton('‚Üê', 'left', '–í–ª–µ–≤–æ', () => {
            if (gameActive && dx !== 1) {
                dx = -1;
                dy = 0;
                tg.HapticFeedback.impactOccurred('light');
            }
        });
        
        const rightButton = createDirectionButton('‚Üí', 'right', '–í–ø—Ä–∞–≤–æ', () => {
            if (gameActive && dx !== -1) {
                dx = 1;
                dy = 0;
                tg.HapticFeedback.impactOccurred('light');
            }
        });
        
        // –î–∂–æ–π—Å—Ç–∏–∫ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∫–Ω–æ–ø–∫–∞–º)
        const joystickContainer = document.createElement('div');
        joystickContainer.style.cssText = `
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: none;
        `;
        
        const joystick = document.createElement('div');
        joystick.style.cssText = `
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #8a2be2, #00d4ff);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: move;
            touch-action: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        `;
        
        joystickContainer.appendChild(joystick);
        
        // –°–æ–±—ã—Ç–∏—è –¥–ª—è –¥–∂–æ–π—Å—Ç–∏–∫–∞
        let isDragging = false;
        let joystickCenterX = 60;
        let joystickCenterY = 60;
        
        joystick.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDragging = true;
            joystick.style.transition = 'none';
        });
        
        document.addEventListener('touchmove', (e) => {
            if (!isDragging || !gameActive) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            const rect = joystickContainer.getBoundingClientRect();
            const x = touch.clientX - rect.left - joystickCenterX;
            const y = touch.clientY - rect.top - joystickCenterY;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –¥–∂–æ–π—Å—Ç–∏–∫–∞
            const distance = Math.sqrt(x * x + y * y);
            const maxDistance = 30;
            
            let limitedX = x;
            let limitedY = y;
            
            if (distance > maxDistance) {
                limitedX = (x / distance) * maxDistance;
                limitedY = (y / distance) * maxDistance;
            }
            
            joystick.style.transform = `translate(calc(-50% + ${limitedX}px), calc(-50% + ${limitedY}px))`;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            const angle = Math.atan2(limitedY, limitedX) * (180 / Math.PI);
            const deadZone = 15; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            
            if (distance > deadZone) {
                if (angle >= -45 && angle < 45 && dx !== -1) {
                    // –í–ø—Ä–∞–≤–æ
                    dx = 1;
                    dy = 0;
                } else if (angle >= 45 && angle < 135 && dy !== -1) {
                    // –í–Ω–∏–∑
                    dx = 0;
                    dy = 1;
                } else if ((angle >= 135 || angle < -135) && dx !== 1) {
                    // –í–ª–µ–≤–æ
                    dx = -1;
                    dy = 0;
                } else if (angle >= -135 && angle < -45 && dy !== 1) {
                    // –í–≤–µ—Ä—Ö
                    dx = 0;
                    dy = -1;
                }
            }
        });
        
        document.addEventListener('touchend', (e) => {
            if (isDragging) {
                isDragging = false;
                joystick.style.transition = 'transform 0.3s ease';
                joystick.style.transform = 'translate(-50%, -50%)';
            }
        });
        
        // –ù–∏–∂–Ω–∏–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫ (–≤–Ω–∏–∑)
        const bottomRow = document.createElement('div');
        bottomRow.style.cssText = `
            display: flex;
            justify-content: center;
        `;
        
        const downButton = createDirectionButton('‚Üì', 'down', '–í–Ω–∏–∑', () => {
            if (gameActive && dy !== -1) {
                dx = 0;
                dy = 1;
                tg.HapticFeedback.impactOccurred('light');
            }
        });
        bottomRow.appendChild(downButton);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        middleRow.appendChild(leftButton);
        middleRow.appendChild(joystickContainer);
        middleRow.appendChild(rightButton);
        
        controlsWrapper.appendChild(topRow);
        controlsWrapper.appendChild(middleRow);
        controlsWrapper.appendChild(bottomRow);
        
        touchControlsContainer.appendChild(controlsWrapper);
        document.body.appendChild(touchControlsContainer);
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∏–ø–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const controlToggle = document.createElement('div');
        controlToggle.style.cssText = `
            position: fixed;
            bottom: 180px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: auto;
        `;
        
        const toggleButton = document.createElement('button');
        toggleButton.innerHTML = 'üéÆ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¥–∂–æ–π—Å—Ç–∏–∫';
        toggleButton.style.cssText = `
            padding: 10px 15px;
            background: rgba(138, 43, 226, 0.8);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        `;
        
        let isJoystickMode = false;
        toggleButton.addEventListener('click', () => {
            isJoystickMode = !isJoystickMode;
            if (isJoystickMode) {
                joystickContainer.style.display = 'block';
                leftButton.style.display = 'none';
                rightButton.style.display = 'none';
                toggleButton.innerHTML = 'üéØ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫–∏';
            } else {
                joystickContainer.style.display = 'none';
                leftButton.style.display = 'flex';
                rightButton.style.display = 'flex';
                toggleButton.innerHTML = 'üéÆ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¥–∂–æ–π—Å—Ç–∏–∫';
            }
        });
        
        controlToggle.appendChild(toggleButton);
        document.body.appendChild(controlToggle);
        
        return touchControlsContainer;
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    function createDirectionButton(symbol, direction, label, onClick) {
        const button = document.createElement('button');
        button.innerHTML = `<span style="font-size: 28px;">${symbol}</span>`;
        button.title = label;
        button.style.cssText = `
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.9), rgba(0, 212, 255, 0.9));
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        `;
        
        // –ê–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
        button.addEventListener('touchstart', (e) => {
            e.preventDefault();
            button.style.transform = 'scale(0.9)';
            button.style.boxShadow = '0 3px 10px rgba(0, 0, 0, 0.2)';
        });
        
        button.addEventListener('touchend', (e) => {
            e.preventDefault();
            button.style.transform = 'scale(1)';
            button.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.3)';
            onClick();
        });
        
        // –î–ª—è –º—ã—à–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        button.addEventListener('mousedown', () => {
            button.style.transform = 'scale(0.9)';
        });
        
        button.addEventListener('mouseup', () => {
            button.style.transform = 'scale(1)';
            onClick();
        });
        
        button.addEventListener('mouseleave', () => {
            button.style.transform = 'scale(1)';
        });
        
        return button;
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
    function updateTouchControlsPosition() {
        const touchControls = document.getElementById('touch-controls');
        if (touchControls) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞
            const bottomOffset = Math.max(30, window.innerHeight * 0.05);
            touchControls.style.bottom = `${bottomOffset}px`;
        }
    }
    
    // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
    function startGame() {
        if (gameActive) return;
        
        // –°–±—Ä–æ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        snake = [{x: 10, y: 10}];
        food = {x: 15, y: 15};
        dx = 1;
        dy = 0;
        currentScore = 0;
        isPaused = false;
        gameActive = true;
        
        document.getElementById('current-score').textContent = '0';
        document.getElementById('pauseBtn').innerHTML = '<span class="emoji">‚è∏Ô∏è</span> –ü–∞—É–∑–∞';
        
        generateFood();
        draw();
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
        clearInterval(gameLoop);
        gameLoop = setInterval(update, 150);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        if ('ontouchstart' in window) {
            setTimeout(() => {
                tg.showAlert('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ —Å–≤–∞–π–ø–∞–π—Ç–µ –ø–æ –∏–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—é');
            }, 1000);
        }
    }
    
    // –ü–∞—É–∑–∞ –∏–≥—Ä—ã
    function togglePause() {
        if (!gameActive) return;
        
        isPaused = !isPaused;
        document.getElementById('pauseBtn').innerHTML = isPaused 
            ? '<span class="emoji">‚ñ∂Ô∏è</span> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å'
            : '<span class="emoji">‚è∏Ô∏è</span> –ü–∞—É–∑–∞';
        
        if (isPaused) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–∞—É–∑—ã
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#00d4ff';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('–ü–ê–£–ó–ê', canvas.width/2, canvas.height/2);
        } else {
            draw();
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    function initControls() {
        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        document.getElementById('playBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('restartBtn').addEventListener('click', startGame);
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', changeDirection);
        
        // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        if ('ontouchstart' in window) {
            // –°–æ–∑–¥–∞–µ–º —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            createTouchControls();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–∞–π–ø—ã –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É
            canvas.addEventListener('touchstart', handleTouchStart, {passive: false});
            canvas.addEventListener('touchmove', handleTouchMove, {passive: false});
            canvas.addEventListener('touchend', handleTouchEnd, {passive: false});
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –ø—Ä–∏ –¥–æ–ª–≥–æ–º –Ω–∞–∂–∞—Ç–∏–∏
            canvas.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                return false;
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
            const instructions = document.querySelector('.game-instructions');
            instructions.innerHTML = `
                <p><span class="emoji">üéÆ</span> <span class="highlight">–°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</span></p>
                <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞</p>
                <p>‚Ä¢ –ò–ª–∏ –¥–µ–ª–∞–π—Ç–µ —Å–≤–∞–π–ø—ã –ø–æ –∏–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—é</p>
                <p>‚Ä¢ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥–∂–æ–π—Å—Ç–∏–∫</p>
            `;
        }
    }
    
    // –ù–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    generateFood();
    initControls();
    draw();
}